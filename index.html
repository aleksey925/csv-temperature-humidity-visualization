<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Temperature and Humidity Visualization</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        #chart {
            width: 100%;
            height: 500px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>CSV Temperature and Humidity Visualization</h1>
    <p>Choose file to visualize:</p>
    <input type="file" id="fileInput" accept=".csv">
    <div id="chart"></div>

    <script>
        document.getElementById('fileInput').addEventListener('change', function(event) {
            // Получаем загруженный файл
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();

                // Чтение файла
                reader.onload = function(e) {
                    const csvText = e.target.result;

                    // Парсим CSV и визуализируем
                    const data = parseCSV(csvText);
                    visualizeData(data);
                };

                reader.readAsText(file);
            }
        });

        /**
         * Парсинг CSV-файла
         * @param {string} text - Текст содержимого CSV
         * @returns {Array} Массив объектов с полями datetime, temperature, humidity
         */
        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim() !== ''); // Удаляем пустые строки
            const header = lines[0].split(';'); // Парсим заголовок
            const rows = lines.slice(1);

            return rows.map(row => {
                const values = row.split(';');
                return {
                    datetime: values[0],
                    temperature: parseFloat(values[1]),
                    humidity: parseFloat(values[2])
                };
            });
        }

        /**
         * Визуализация данных через Plotly
         * @param {Array} data - Массив данных [{datetime, temperature, humidity}]
         */
        function visualizeData(data) {
            const dates = data.map(entry => entry.datetime);
            const temperatures = data.map(entry => entry.temperature);
            const humidity = data.map(entry => entry.humidity);

            // Создаём график температуры
            const temperatureTrace = {
                x: dates,
                y: temperatures,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Temperature',
                line: { color: 'royalblue' },
                marker: { size: 8 }
            };

            // Создаём график влажности
            const humidityTrace = {
                x: dates,
                y: humidity,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Humidity',
                line: { color: 'orange' },
                marker: { size: 8 },
                yaxis: 'y2' // Связываем с правой осью
            };

            // Настройки графика
            const layout = {
                title: 'Temperature and Humidity Over Time',
                xaxis: {
                    title: 'DateTime',
                    showgrid: true
                },
                yaxis: {
                    title: 'Temperature (°C)'
                },
                yaxis2: {
                    title: 'Humidity (%)',
                    overlaying: 'y', // Наложение оси
                    side: 'right' // Позиция справа
                },
                legend: { orientation: 'h', x: 0.5, xanchor: 'center', y: -0.2 }
            };

            // Отображаем график
            Plotly.newPlot('chart', [temperatureTrace, humidityTrace], layout);
        }
    </script>
</body>
</html>